<odoo>

    <record id="view_reservation_form" model="ir.ui.view">
        <field name="name">pms.reservation.form</field>
        <field name="model">pms.reservation</field>
        <field name="arch" type="xml">
            <form string="Reservation">
                <header>
                    <button
                        id="action_book"
                        name="action_book"
                        string="Book"
                        class="oe_highlight"
                        type="object"
                        groups="pms_base.group_pms_manager"
                        attrs="{'invisible': [('stage_id', '!=', (%(pms_sale.pms_stage_new)d))]}"
                    />
                    <button
                        id="action_confirm"
                        name="action_confirm"
                        string="Confirm"
                        class="oe_highlight"
                        type="object"
                        groups="pms_base.group_pms_manager"
                        attrs="{'invisible': [('stage_id', '!=', (%(pms_sale.pms_stage_booked)d))]}"
                    />
                    <button
                        id="action_check_in"
                        name="action_check_in"
                        string="Check In"
                        class="oe_highlight"
                        type="object"
                        groups="pms_base.group_pms_manager"
                        attrs="{'invisible': [('stage_id', '!=', (%(pms_sale.pms_stage_confirmed)d))]}"
                    />
                    <button
                        id="action_check_out"
                        name="action_check_out"
                        string="Check Out"
                        class="oe_highlight"
                        type="object"
                        groups="pms_base.group_pms_manager"
                        attrs="{'invisible': [('stage_id', '!=', (%(pms_sale.pms_stage_checked_in)d))]}"
                    />
                    <field
                        name="stage_id"
                        widget="statusbar"
                        options="{'fold_field': 'fold'}"
                        domain="[('stage_type', '=', 'reservation'),
                                    ('team_ids', 'in', (team_id, False))]"
                    />
                </header>
                <sheet string="Reservation">
                    <div class="oe_button_box" name="button_box">
                        <button
                            name="action_view_invoices"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-pencil-square-o"
                            groups="account.group_account_invoice"
                            attrs="{'invisible': [('invoice_count', '=', 0)]}"
                        >
                            <field
                                name="invoice_count"
                                widget="statinfo"
                                string="Invoices"
                            />
                        </button>
                    </div>
                    <h1>
                        <field nolabel="1" name="name" class="oe_inline" />
                    </h1>
                    <group id="main">
                        <group id="main-left">
                            <field name="property_id" required="1" />
                            <field
                                name="team_id"
                                required="1"
                                groups="pms_base.group_pms_show_team"
                            />
                            <field name="partner_id" required="1" />
                            <field name="user_id" required="1" />
                            <field name="sale_order_id" invisible="1" />
                            <field name="sale_order_line_id" invisible="1" />
                        </group>
                        <group id="main-right">
                            <field name="date" />
                            <field name="start" required="1" string="Check In" />
                            <field name="duration" />
                            <field name="stop" required="1" string="Check Out" />
                            <field
                                name="company_id"
                                options="{'no_create': True}"
                                groups="base.group_multi_company"
                            />
                            <field
                                name="tag_ids"
                                widget="many2many_tags"
                                options="{'color_field': 'color', 'no_create_edit': True}"
                            />
                        </group>
                    </group>
                    <notebook>
                        <page name="guest_ids" string="Guests">
                            <group>
                                <field name="no_of_guests" />
                            </group>
                            <field name="guest_ids" nolabel="1">
                                <tree string="Guests" editable="bottom">
                                    <field
                                        name="partner_id"
                                        domain="[('is_property', '=', False)]"
                                    />
                                    <field name="name" />
                                    <field name="phone" />
                                    <field name="email" />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" />
                    <field name="activity_ids" widget="mail_activity" />
                    <field
                        name="message_ids"
                        widget="mail_thread"
                        options="{'post_refresh': 'recipients'}"
                    />
                </div>
            </form>
        </field>
    </record>

    <record id="view_reservation_tree" model="ir.ui.view">
        <field name="name">pms.reservation.tree</field>
        <field name="model">pms.reservation</field>
        <field name="arch" type="xml">
            <tree string="Reservation">
                <field name="name" />
                <field name="partner_id" />
                <field name="start" />
                <field name="stop" />
                <field name="property_id" />
                <field name="stage_id" />
            </tree>
        </field>
    </record>

    <record id="view_reservation_search" model="ir.ui.view">
        <field name="name">pms.reservation.search</field>
        <field name="model">pms.reservation</field>
        <field name="arch" type="xml">
            <search string="Reservation Detail">
                <field name="name" />
                <field name="partner_id" />
                <field name="start" />
                <field name="stop" />
                <field name="property_id" />
                <field name="team_id" />
                <newline />
                <searchpanel>
                    <field
                        name="stage_id"
                        string="State"
                        enable_counters="1"
                        select="multi"
                    />
                    <field
                        name="invoice_status"
                        string="Payment Status"
                        enable_counters="1"
                        select="multi"
                    />
                </searchpanel>
                <filter
                    string="Today Reservations"
                    name="today_reservation"
                    domain="[('start','&lt;=', (datetime.date.today()).strftime('%Y-%m-%d')),('start','&gt;=',(datetime.date.today()).strftime('%Y-%m-%d'))]"
                />

                <filter
                    string="Tomorrow Reservations"
                    domain="[('start','&gt;=',datetime.datetime.now().strftime('%Y-%m-%d 00:00:00')),('stop','&lt;=', ((context_today() + relativedelta(days=1)).strftime('%Y-%m-%d')))]"
                    name="tomorrow_reservation"
                />

                <filter
                    string="This week Reservations"
                    domain="[('start','&gt;=', (context_today() - relativedelta(weeks=1)).strftime('%Y-%m-%d')),('stop','&lt;=',(context_today() -relativedelta(weeks=1, weekday=0) + relativedelta(weeks=0,day=0, weekday=6)).strftime('%Y-%m-%d'))]"
                    name="this_reservation"
                />

                <filter
                    string="Total Reservations"
                    name="total_reservation"
                    domain="[('stage_id','!=',%(pms_sale.pms_stage_checked_out)d),('stage_id','!=',%(pms_sale.pms_stage_cancelled)d)]"
                />
            </search>
        </field>
    </record>

    <record id="view_reservation_timeline" model="ir.ui.view">
        <field name="name">pms.reservation.timeline</field>
        <field name="model">pms.reservation</field>
        <field name="arch" type="xml">
            <timeline
                date_start="start"
                date_stop="stop"
                string="Reservations"
                default_group_by="property_id"
                event_open_popup="true"
                mode="week"
                colors="#ffffff:stage_id=='New';"
                custom_color="true"
            />
        </field>
    </record>

    <record id="view_reservation_calendar" model="ir.ui.view">
        <field name="name">pms.reservation.calendar</field>
        <field name="model">pms.reservation</field>
        <field name="arch" type="xml">
            <calendar
                string="Reservations"
                date_start="start"
                date_delay="stop"
                color="stage_id"
            >
                <field name="name" />
                <field name="stage_id" />
                <field name="property_id" />
                <field name="partner_id" />
            </calendar>
        </field>
    </record>

    <record id="view_reservation_kanban" model="ir.ui.view">
        <field name="name">pms.reservation.kanban</field>
        <field name="model">pms.reservation</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage_id" class="o_kanban_small_column">
                <field
                    name="stage_id"
                    options='{"group_by_tooltip": {"description": "Description"}}'
                />
                <field name="name" />
                <field name="priority" />
                <field name="property_id" />
                <field name="partner_id" />
                <field name="user_id" />
                <field name="color" />
                <templates>
                    <t t-name="kanban-box">
                        <div
                            t-attf-class="#{kanban_color(record.color.raw_value)} oe_kanban_global_click"
                            name="pms_reservation"
                        >
                            <div class="o_dropdown_kanban dropdown">
                                <a
                                    role="button"
                                    class="dropdown-toggle o-no-caret btn"
                                    data-toggle="dropdown"
                                    href="#"
                                    aria-label="Dropdown menu"
                                    title="Dropdown menu"
                                >
                                    <span class="fa fa-ellipsis-v" />
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <a
                                        t-if="widget.editable"
                                        role="menuitem"
                                        type="edit"
                                        class="dropdown-item"
                                    >Edit
                                    </a>
                                    <a
                                        t-if="widget.deletable"
                                        role="menuitem"
                                        type="delete"
                                        class="dropdown-item"
                                    >
                                        Delete
                                    </a>
                                    <div role="separator" class="dropdown-divider" />
                                    <ul
                                        class="oe_kanban_colorpicker"
                                        data-field="color"
                                    />
                                </div>
                            </div>
                            <div class="oe_kanban_content">
                                <div>
                                    <strong class="o_kanban_record_title">
                                        <field name="name" />
                                    </strong>
                                </div>
                                <div>
                                    <field
                                        name="tag_ids"
                                        widget="many2many_tags"
                                        options="{'color_field': 'color'}"
                                    />
                                </div><div>
                                    <field name="partner_id" /> @ <field
                                        name="property_id"
                                    />
                                </div>
                                <div><field name="duration" /> night(s)</div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <field name="priority" widget="priority" />
                                        <field
                                            name="activity_ids"
                                            widget="kanban_activity"
                                        />
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <field
                                            name="user_id"
                                            widget="many2one_avatar_user"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="oe_clear" />
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="view_reservation_pivot" model="ir.ui.view">
        <field name="name">pms.reservation.pivot</field>
        <field name="model">pms.reservation</field>
        <field name="arch" type="xml">
            <pivot string="Reservations">
                <field name="stop" type="row" interval="month" />
                <field name="stage_id" type="row" />
            </pivot>
        </field>
    </record>

    <record id="view_reservation_graph" model="ir.ui.view">
        <field name="name">pms.reservation.graph</field>
        <field name="model">pms.reservation</field>
        <field name="arch" type="xml">
            <graph string="Reservations">
                <field name="stop" type="row" interval="day" />
                <field name="stage_id" type="row" />
            </graph>
        </field>
    </record>

    <record id="action_board_reservation" model="ir.actions.act_window">
        <field name="name">Reservations</field>
        <field name="res_model">pms.reservation</field>
        <field name="view_mode">timeline,kanban,calendar,tree,form</field>
    </record>

    <record id="action_sale_reservation" model="ir.actions.act_window">
        <field name="name">Reservations</field>
        <field name="res_model">pms.reservation</field>
        <field name="view_mode">timeline</field>
        <field name="target">current</field>
    </record>

    <record id="action_operations_reservation" model="ir.actions.act_window">
        <field name="name">Reservations</field>
        <field name="res_model">pms.reservation</field>
        <field name="view_mode">kanban,tree,form,timeline,calendar</field>
    </record>

    <record id="action_report_reservation" model="ir.actions.act_window">
        <field name="name">Reservations</field>
        <field name="res_model">pms.reservation</field>
        <field name="view_mode">graph,pivot</field>
    </record>

    <record id="action_pms_reservation" model="ir.actions.act_window">
        <field name="name">Reservations</field>
        <field name="res_model">pms.reservation</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="reservation_action_from_dashboard" model="ir.actions.act_window">
        <field name="name">Orders</field>
        <field name="res_model">pms.reservation</field>
        <field name="view_mode">kanban,tree,form,calendar</field>
        <field name="context">{'default_team_id': active_id}</field>
        <field name="domain">[('team_id', '=', active_id)]</field>
    </record>

</odoo>
